{% extends "layout.html" %}
{% block title %}Vote{% endblock %}
{% block content %}
  <script>
    function toggleModal() {
      let modal = document.getElementById('doneModal');
      modal.style.display = modal.style.display === "block" ? "none" : "block";
    }

    function toggleSkip() {
      let modal = document.getElementById('skipModal');
      modal.style.display = modal.style.display === "block" ? "none" : "block";
    }

    function toggleReport() {
      let modal = document.getElementById('reportModal');
      modal.style.display = modal.style.display === "block" ? "none" : "block";
    }

    function activatePrevious() {
      let prev = document.getElementById('previousProject');
      let next = document.getElementById('nextProject');
      let button = document.getElementById('modalNextButton');
      let bottomText = document.getElementById('bottomText');
      let topText = document.getElementById('topText');
      let buttonText = document.getElementById('modalNextText');
      next.classList = ['item projectItem'];
      prev.classList = ['item projectItem enabledProjectItem'];
      button.value = 'Previous';
      button.type='submit';
      button.classList = ['modal-next-button-button active-button'];
      buttonText.classList = ['modal-button-text modal-button-text-active'];
      topText.classList = ['selectedText selectedSelected'];
      bottomText.classList = ['selectedText selectedNotSelected'];
    }
    function activateNext() {
      let prev = document.getElementById('previousProject');
      let next = document.getElementById('nextProject');
      let button = document.getElementById('modalNextButton');
      let bottomText = document.getElementById('bottomText');
      let topText = document.getElementById('topText');
      let buttonText = document.getElementById('modalNextText');
      next.classList = ['item projectItem enabledProjectItem'];
      prev.classList = ['item projectItem'];
      button.value = 'Current';
      button.type='submit';
      button.classList = ['modal-next-button-button active-button'];
      buttonText.classList = ['modal-button-text modal-button-text-active'];
      topText.classList = ['selectedText selectedNotSelected'];
      bottomText.classList = ['selectedText selectedSelected'];
    }

    function topSkip() {
      const skip = document.getElementById('modalSkipButton');
      let top = document.getElementById('skipRadioTop');
      let bottom = document.getElementById('skipRadioBottom');
      let button = document.getElementById('modalSkipButton');
      let buttonText = document.getElementById('modalSkipText');
      buttonText.classList = ['modal-button-text modal-skip-text-active'];
      button.type = 'submit';
      button.classList = ['modal-next-button-button skip-active'];
      top.classList = ['skipRadio skipActive'];
      bottom.classList = ['skipRadio'];
      skip.value = 'SkipAbsent';
    }
    function bottomSkip() {
      const skip = document.getElementById('modalSkipButton');
      let top = document.getElementById('skipRadioTop');
      let bottom = document.getElementById('skipRadioBottom');
      let button = document.getElementById('modalSkipButton');
      let buttonText = document.getElementById('modalSkipText');
      buttonText.classList = ['modal-button-text modal-skip-text-active'];
      button.type = 'submit';
      button.classList = ['modal-next-button-button skip-active'];
      bottom.classList = ['skipRadio skipActive'];
      top.classList = ['skipRadio'];
      skip.value = 'SkipBusy';
    }

    function setChecks() {
      let checks = document.forms['checkboxForm'].elements['checkbox[]'];
      let button = document.getElementById('modalReportButton');
      let buttonText = document.getElementById('modalReportText');
      buttonText.classList = ['modal-button-text modal-report-text-active'];
      let vals = "";
      let checkedCount = 0;
      for(let i = 0; i < checks.length; i++) {
        if (checks[i].checked) {
          vals += checks[i].value + " ";
          checks[i].classList = ['reportCheck reportActive'];
          checkedCount++;
        } else {
          checks[i].classList = ['reportCheck'];
        }
      }

      if(checkedCount === 0) {
        button.classList = ['modal-next-button-button'];
        button.type = 'button';
      } else {
        button.classList = ['modal-next-button-button report-active'];
        button.type = 'submit';
      }

      button.value = vals.trim();
    }
    $(document).ready(function() {
    $('.report-table tr td').click(function(event) {
    if (event.target.type !== 'checkbox') {
      $(':checkbox', this).trigger('click');
      }
    });
  });
  </script>
  <style type="text/css">
table {
  border: 0;
}
  tr {
    border: 0;
  }
  td {
    border: 0;
  }
</style>
  <div class="item" style="padding-bottom: 80px;">
    <div class="projectInfo">
      <h2 class="projectScreenTitle">Evaluate the following project.</h2>
      <p class="voteItemTeam" style="color: black; padding-bottom: 8px;">CURRENT PROJECT</p>
      <div class="item projectItem" style="box-shadow: none; border: 1px solid #000F9B;">
        {% with item=next %}
          {% include "_item.html" %}
        {% endwith %}
      </div>

      <p class="voteItemTeam" style="color: black; padding-bottom: 8px; padding-top: 24px;">LAST PROJECT YOU VISITED</p>
      <div class="item">
        <div class="item projectItem" style="box-shadow: none;">
          {% with item=prev %}
            {% include "_item.html" %}
          {% endwith %}
        </div>
      </div>
    </div>
  </div>
  {#  <div class="item">
    <div class="banner" id="vote-header">
      <h1>Vote</h1>
    </div>
    <div class="info">
      <form action="/vote" method="post">
        <p class="center">Which one is better?</p>
        <input type="submit" name="action" value="Previous" id="vote-previous" class="button-left">
        <input type="submit" name="action" value="Current" id="vote-current" class="button-right">
        <input type="submit" name="action" value="Skip" id="vote-skip" class="button-full button-gap">
        <input type="hidden" name="prev_id" value="{{ prev.id }}">
        <input type="hidden" name="next_id" value="{{ next.id }}">
        <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
      </form>
    </div>
  </div>#}
  <div class="bottomPanel">
    <button class="flagButton" type="button" id="reportbutton" onclick="toggleReport()"></button>
    <button class="skipButton" type="button" id="skipButton" onclick="toggleSkip()"></button>
    <button class="doneButton doneButtonText" type="button" id="doneButton" onclick="toggleModal()">Done With Visit</button>
  </div>

  <div class="modal" id="reportModal">
    <div class="modal-content">
      <div class="modal-content-projects-container">
        <h2 class="skipTitle" style="padding-bottom: 0; margin-bottom: 16px;">The <span class="skipTitlePurple">current project</span> needs to be reviewed for the following reasons:</h2>
        <form id="checkboxForm">
        <table style="width: 100%" class="borderless report-table" rules="none">
          <tr>
            <td>
              <input type="checkbox" class="reportCheck" id="reportCheckOne" value="NoDemo" name="checkbox[]" onclick="setChecks()"/>
            </td>
            <td>
              <label for=reportCheckOne class="skipText">The team cannot demo their project or provide evidence of the work described.</label>
            </td>
          </tr>
          <tr style="height: 16px;"></tr>
          <tr>
            <td>
              <input type="checkbox" class="reportCheck" id="reportCheckTwo" value="TooComplex" name="checkbox[]" onclick="setChecks()"/>
            </td>
            <td>
              <label for="reportCheckTwo" class="skipText">The project appears too complex to have been created within the prescribed timeframe of the hackathon.</label>
            </td>
          </tr>
          <tr style="height: 16px;"></tr>
          <tr>
            <td>
              <input type="checkbox" class="reportCheck" id="reportCheckThree" value="Offensive" name="checkbox[]" onclick="setChecks()"/>
            </td>
            <td>
              <label for="reportCheckThree" class="skipText">The project is or has offensive, harrassing, or inappropriate content and/or breaks the Code of Conduct and Ethics.</label>
            </td>
          </tr>
        </table>
        </form>
      </div>

      <div class="modal-close">
        <span class="modal-button-text" id="skipCloseButton" style="height: 100%; margin-top: 0; padding-top: 24px;" onclick="toggleReport()">CLOSE</span>
      </div>

      <div class="modal-next">
        <form action="/report" method="post" class="submit-form">
          <button id="modalReportButton" class="modal-next-button-button" name="reason" type="button" value="Unknown"
                  style="background: 0; border: 0;"><a class="modal-button-text" id="modalReportText" style="margin: 0;">SUBMIT FOR REVIEW</a></button>
          <input type="hidden" name="next_id" value="{{ next.id }}">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
        </form>
      </div>

    </div>
  </div>

  <div class="modal" id="skipModal">
    <div class="modal-content">
      <div class="modal-content-projects-container">
        <h2 class="skipTitle" style="padding-bottom: 0; margin-bottom: 16px;">I need to skip the <span class="skipTitlePurple">current project</span> because:</h2>
        <table style="width: 100%" class="borderless" rules="none">
          <tr onclick="topSkip()">
            <td>
              <div class="skipRadio" id="skipRadioTop" onclick="topSkip()"></div>
            </td>
            <td class="skipText">They are not present for judging</td>
          </tr>
          <tr style="height: 16px;"></tr>
          <tr onclick="bottomSkip()">
            <td>
              <div class="skipRadio" id="skipRadioBottom" onclick="bottomSkip()"></div>
            </td>
            <td class="skipText">They are currently occupied with presenting to another judge.</td>
          </tr>
        </table>
      </div>

      <div class="modal-close">
        <span class="modal-button-text" id="skipCloseButton" style="height: 100%; margin-top: 0; padding-top: 24px;" onclick="toggleSkip()">CLOSE</span>
      </div>

      <div class="modal-next">
        <form action="/vote" method="post" class="submit-form">
          <button id="modalSkipButton" class="modal-next-button-button" name="action" type="button" value="Skip"
                  style="background: 0; border: 0;"><a class="modal-button-text" id="modalSkipText" style="margin: 0;">CONFIRM SKIP</a></button>
          <input type="hidden" name="prev_id" value="{{ prev.id }}">
          <input type="hidden" name="next_id" value="{{ next.id }}">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
        </form>
      </div>
    </div>
  </div>

  <div class="modal" id="doneModal">
    <div class="modal-content">
      <div class="modal-content-projects-container">
        <h2 class="projectScreenTitle" style="margin-bottom: 16px; padding-bottom: 0;">Select the better project to continue.</h2>
        <p class="voteItemTeam purpleBold" style="color: black; padding-bottom: 8px; padding-top: 0;">CURRENT PROJECT</p>
        <div class="item projectItem" style="padding-bottom:0" id="nextProject" onclick="activateNext()">
          {% with item=next %}
            {% include "_strippeditem.html" %}
          {% endwith %}
          <p class="selectedText" id="bottomText"></p>
        </div>
        <p class="voteItemTeam" style="color: black; padding-bottom: 8px; padding-top: 16px; margin-top: 0;">PREVIOUS PROJECT</p>
        <div class="item projectItem" style="padding-bottom:0" id="previousProject" onclick="activatePrevious()">
          {% with item=prev %}
            {% include "_strippeditem.html" %}
          {% endwith %}
          <p class="selectedText" id="topText"></p>
        </div>
      </div>
      <div class="modal-close">
        <span class="modal-button-text" id="modalCloseButton" style="height: 100%; margin-top: 0; padding-top: 24px;" onclick="toggleModal()">CLOSE</span>
      </div>
      <div class="modal-next">
        <form action="/vote" method="post" class="submit-form">
          <button id="modalNextButton" class="modal-next-button-button" name="action" type="button" value=""
                  style="background: 0; border: 0;"><a class="modal-button-text" id="modalNextText" style="margin: 0;">NEXT PROJECT</a></button>
          <input type="hidden" name="prev_id" value="{{ prev.id }}">
          <input type="hidden" name="next_id" value="{{ next.id }}">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
        </form>
      </div>
    </div>
  </div>

{% endblock %}
